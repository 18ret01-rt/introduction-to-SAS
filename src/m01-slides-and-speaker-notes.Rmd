---
title: "Introduction to SAS, Running a basic SAS program"
author: "Steve Simon"
date: "Created 2021-05-30"
output: powerpoint_presentation
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding,
  output_dir = "../results", output_format = "all") })  
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(echo=FALSE, comment="")
suppressMessages(suppressWarnings(library(dplyr)))
suppressMessages(suppressWarnings(library(knitr)))
suppressMessages(suppressWarnings(library(magrittr)))
suppressMessages(suppressWarnings(library(stringr)))
```

### Overview

+ Run a very basic SAS program
+ Baby steps
  + Store data in a permanent location
  + Store output as pdf or html files
  + Read data from a text file

<div class="notes">

author: Steve Simon
date: created 2021-05-30
purpose: to produce slides for module01 videos
license: public domain

Here is an overview of what I want to cover in module01. We'll start very slowly with a simple and basic SAS program that reads in a small dataset and prints out the first line of data.

Then we will take a series of baby steps. These follow my basic philosophy of data analysis. Never jump in at the deep end of a swimming pool. Start at the shallow end and slowly wade into deeper water.

THink of this as baby steps. You don't want to add too much complexity to the program all at once. 

The first baby step is storing the data that you read in at a permanent location so that it can be re-used easily in a later program.

Then you will see the code you need to add so that your output is stored in pdf or html format.

Finally, you will see how to move the data outside the program to a separate file.

</div>

### Directory structure

+ One directory for the entire class
  + Possibly one directory for each module
+ Subdirectory structure
  + src
  + results
  + data
  + others?
    + images
    + doc
    
<div class="notes">

Make sure you store things consistently. This part of the requirements for this class.

Store all your programs for this calss in a single directory. You can call it "sas" or "5507" or anything you like. Some people may prefer to create a separate directory for each module in this class. That's fine also.

Most importantly, create three subdirectories, src, results, and data. Store your programs in src, your output in results and your raw and intermediate datasets in data. You may wish to create other subdirectories, such an images folder for any graphs you produce, a doc folder for any documentation you collect, but the three imporant subdirectory folders are src, results, and data.

</div>

### Basic program, part 1

```{r}
tx <- readLines("m01-5507-simon-basic-program.sas")
tx %>% 
  str_subset(fixed("*")) %>%
  paste0(collapse="\n") -> tx1  
```

```{}
`r tx1`
```

<div class="notes">

Here is the first piece of the basic program I want you to run. It has a brief documentation header that lists the author, date, purpose of the program, and license. I always place my code in the public domain.

</div>

### Basic program, part 2

```{r}
tx %>% str_which("^data") -> i1
tx %>% str_which("^;") -> i2
tx %>%
  extract(i1:i2) %>%
  paste0(collapse="\n") -> tx2  
  
```

```{}
`r tx2`
```

<div class="notes">

The data statement creates a dataset with the name "small_example".

The input statement tells SAS to expect two variables and assigns them the names x and y.

The datalines statement tells SAS to read the data directly below this line. This is NOT a recommended practice. You should normally keep your data separate from your code. I am doing this only for the sake of simplicity. You will see in just a minute how to handle data that comes in a separate file.

The three lines of data follow. A single semicolon tells SAS that this is the end of the data.

</div>

### Basic program, part 3

```{r}
tx %>% str_which("^proc") -> i3
tx %>% str_which("run;") -> i4
tx %>%
  extract(i3:i4) %>%
  paste0(collapse="\n") -> tx3  
  
```

```{}
`r tx3`
```

<div class="notes">

The print procedure will print part or all of a dataset. 

You specify the name of the dataset with the data= option. The options obs=1 tells SAS to print only the first row.

The title1 statement prints a descriptive title on the first line of output.

The run statement tells SAS that there is no more information associated with this procedure.

</div>

### Break #1

+ What have you learned
  + How to read a small dataset
  + How to print a small dataset

+ What's coming next
  + Permanent storage
  + m01-libname.sas
  + m01-reuse.sas

### Permanent storage, part 1

```{r}
tx <- readLines("m01-5507-simon-permanent-storage.sas")
tx %>% 
  str_subset(fixed("*")) %>%
  paste0(collapse="\n") -> tx1  
```

```{}
`r tx1`
```

<div class="notes">

Let's look at a modified program that stores the data in a permanent location.

Here is the documentation header. No big changes here other than the name of the program and the purpose.

</div>

### Permanent storage, part 2

```{r}
tx %>% str_which("libname") -> i1
tx %>% str_which("^;") -> i2
tx %>%
  extract(i1:i2) %>%
  paste0(collapse="\n") -> tx2  
```


```{}
`r tx2`
```

<div class="notes">

Notice the top line in this section. This is the libname statement. It tells SAS that you want to establish a permanent storage location at ../data. The ../data tells the computer system to go one level closer to the root directory, and then slide into the data subdirectory.

You assign a brief name (no more than eight characters!) to this location. In my program, I use the name "perm" but anything is fine here.

Then you prefix the dataset name simple_example with the libname location and a dot. This is called a two part name by SAS. The first part gives the permanent location folder and the second part gives the file name.

Once you establish a two-part name for a dataset, you assure that it is stored for later re-use.

</div>

### Permanent storage, part 3

```{r}
tx %>% str_which("proc") -> i3
tx %>% str_which("run;") -> i4
tx %>%
  extract(i3:i4) %>%
  paste0(collapse="\n") -> tx3  
```


```{}
`r tx3`
```

<div class="notes">

Once you establish a two-part name, use it everywhere.

</div>
  
### Re-using data in permanent storage, part 1

```{r}
tx <- readLines("m01-5507-simon-re-use.sas")
tx %>% 
  str_subset(fixed("*")) %>%
  paste0(collapse="\n") -> tx1  
```

```{}
`r tx1`
```

<div class="notes">

Here's a program that re-uses the dataset you just placed in permanent storage.

First, let's show the documentation header.

</div>

### Re-using data in permanent storage, part 2

```{r}
tx %>% str_which("libname") -> i1
tx %>% str_which("run;") -> i2
tx %>%
  extract(i1:i2) %>%
  paste0(collapse="\n") -> tx2  
```


```{}
`r tx2`
```

<div class="notes">

Notice that there is no data step in this program, you start with a libname statement that reminds SAS where you stored the permanent dataset. Then you just refer to the two-part name in the data= option of any SAS procedure. Here we are computing some simple descriptive statistics using proc means.

</div>

### Break #2

+ What have you learned
  + Permanent storage
  
+ What's coming next
  + Saving your output
  + m01-saved-pdf.sas
  + m01-saved-pdf.sas

### Saving output as pdf, part 1

```{r}
tx <- readLines("m01-5507-simon-saved-pdf.sas")
tx %>% 
  str_subset(fixed("*")) %>%
  paste0(collapse="\n") -> tx1  
```

```{}
`r tx1`
```

<div class="notes">

Let's look at a modified program that stores your output as a pdf file.

Here is the documentation header.

</div>

### Saving output as pdf, part 2

```{r}
tx %>% str_which("libname") -> i1
tx %>% str_which("^;") -> i2
tx %>%
  extract(i1:i2) %>%
  paste0(collapse="\n") -> tx2  
```


```{}
`r tx2`
```

<div class="notes">

The ods statement should be placed near the top of the code, certainly before any SAS procedure that produces output.

</div>

### Saving output as pdf, part 3

```{r}
tx %>% str_which("proc") -> i3
tx %>% str_which("close;") -> i4
tx %>%
  extract(i3:i4) %>%
  paste0(collapse="\n") -> tx3  
```


```{}
`r tx3`
```

<div class="notes">

Near the bottom, you turn off the output. Place this AFTER the last SAS procedure that produces output.

</div>
  
### Saving output as html, part 1

```{r}
tx <- readLines("m01-5507-simon-saved-html.sas")
tx %>% 
  str_subset(fixed("*")) %>%
  paste0(collapse="\n") -> tx1  
```

```{}
`r tx1`
```

<div class="notes">

Things change just a little bit if you want to save your output in html format.

Here is the documentation header.

</div>

### Saving output as html, part 2

```{r}
tx %>% str_which("libname") -> i1
tx %>% str_which("^;") -> i2
tx %>%
  extract(i1:i2) %>%
  paste0(collapse="\n") -> tx2  
```


```{}
`r tx2`
```

<div class="notes">

Notice the use of "body" in the ods statement.

</div>

### Saving output as html, part 3

```{r}
tx %>% str_which("proc") -> i3
tx %>% str_which("close;") -> i4
tx %>%
  extract(i3:i4) %>%
  paste0(collapse="\n") -> tx3  
```


```{}
`r tx3`
```

<div class="notes">

Near the bottom, you turn off the output in pretty much the same way.

</div>
  
### Break #3

+ What have you learned
  + Saving your output
  
+ What's coming next
  + Getting data from a file
  + m01-input-text.sas

### Reading data from a file, part 1

```{r}
tx <- readLines("m01-5507-simon-input-text.sas")
tx %>% 
  str_subset(fixed("*")) %>%
  paste0(collapse="\n") -> tx1  
```

```{}
`r tx1`
```

<div class="notes">

It is a very basic principle of good computing practices that you keep your data and your program in separate files. This code shows you how to do this using the infile statement.

</div>

### Reading data from a file, part 2

```{r}
tx %>% str_which("libname") -> i1
tx %>% str_which("input x y;") -> i2
tx %>%
  extract(i1:(i2+1)) %>%
  paste0(collapse="\n") -> tx2  
```


```{}
`r tx2`
```

<div class="notes">

The filename statement tells SAS where a particular dataset is stored: both the path and the name of the file. It associates that path and filename with a variable that you refer to using the infile statement.

</div>

### Reading data from a file, part 3

```{r}
tx %>% str_which("proc") -> i3
tx %>% str_which("close;") -> i4
tx %>%
  extract(i3:i4) %>%
  paste0(collapse="\n") -> tx3  
```


```{}
`r tx3`
```

<div class="notes">

The last part of the program remains unchanged.

</div>
  
### Reading data from a file, part 4

```{r}
tx <- readLines("../data/six-numbers.txt")
tx %>% 
  paste0(collapse="\n") -> tx1  
```

```{}
`r tx1`
```

<div class="notes">

This is what your data file looks like. It is just six numbers arranged in a grid.

You will see many variations on the layout of data, and SAS can handle just about any variation. You will see how to handle many of those variations in an upcoming module.

</div>


### Summary

+ What have you learned
  + Run a very basic SAS program
  + Store data in a permanent location
  + Store output as pdf or html files
  + Read data from a text file
